/*! Aladdin.js v1.0.9 (c) 2016-2017 Aladdin */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.aladdin=e()}(this,function(){"use strict";function t(t){setTimeout(t)}function e(t,e,n){Object.defineProperty(t,e,{value:n,writable:!1})}function n(t,e,n){if(void 0===n&&(n="string"),void 0===e||typeof e!==n)throw new TypeError("The "+t+" must be a "+n+" and a value")}function o(t){var e=function(e){e&&this.emit("error",e),t.apply(null,arguments)}.bind(this);return e.keep=t.keep,e}function i(){this._ts=(new Date).getTime(),this._callTimes=0,this._handlers={},this._subscribers={}}function r(t,e){if(void 0===e&&(e=!1),!t||"object"!=typeof t)return"";var n=[];for(var o in t){var i=t[o];if(Array.isArray(i))for(var r in i)n.push((e?o:o+"[]")+"="+encodeURIComponent(i[r]));else n.push(o+"="+encodeURIComponent(i))}return n.join("&")}function a(t,e,n){void 0===n&&(n=!1);var o=r(e,n);return""!==o&&(o=(/\?/.test(t)?"&":"?")+o),t+o}function s(t){this._aladdin=t}function c(t){var e=this;for(var n in t)e[n]=t[n]}function u(t){return function(e,n){t(e,new c(n))}}function l(t){return t=t||{},t.method=t.method?t.method.toLowerCase():"get",t.headers||(t.headers={}),"post"!==t.method&&"put"!==t.method&&"patch"!==t.method&&"delete"!==t.method||t.headers["Content-Type"]||(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.qs&&"[object Object]"===Object.prototype.toString.call(t.qs)&&(t.url=a(t.url,t.qs,t.traditional)),t.body&&"[object Object]"===Object.prototype.toString.call(t.body)&&(/x-www-form-urlencoded/.test(t.headers["Content-Type"])?t.body=r(t.body,t.traditional):t.body=JSON.stringify(t.body)),t}function p(t){this._aladdin=t}function d(t){this._aladdin=t}function f(t){d.call(this,t)}function h(t){d.call(this,t)}function y(t){this._aladdin=t}function m(t){this._aladdin=t}var _,b,v,g=navigator.userAgent,w=/AladdinHybrid\/(\d+\.\d+\.?\d*.*?) \((.*?) (\d+\.\d+\.?\d*.*?)\)/i.exec(g);Array.isArray(w)&&(_=w[1],b=w[2],v=w[3]);var A,C={hybridVersion:_,appName:b,appVersion:v,isMobile:/Mobile/i.test(g),isAndroid:/Android/i.test(g),isiOS:!!g.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/i),isiPhone:/iPhone/i.test(g),isiPad:/iPad/i.test(g),isiPod:/iPod/i.test(g),isHybrid:!!_,isBrowser:!_,isWechat:/MicroMessenger/i.test(g),isQQ:/ QQ\//i.test(g)},S={};e(i.prototype,"version","1.0.9"),i.prototype.on=function(t,e){return n("event name",t),n("event listener",e,"function"),(this._subscribers[t]||(this._subscribers[t]=[])).push(e),this},i.prototype.once=function(t,e){var n=this,o=function(){n.off(t,o),e.apply(this,arguments)};return o.listener=e,this.on(t,o),this},i.prototype.off=function(t,e){var o=this;if(!arguments.length){for(t in o._subscribers)delete o._subscribers[t];return this}if(n("event name",t),!e&&this._subscribers[t])return delete this._subscribers[t],this;var i=this._subscribers[t];if(!i)return this;for(var r,a=i.length;a--;)if((r=i[a])===e||r.listener===e){o._subscribers[t].splice(a,1);break}return this},i.prototype.emit=function(t){for(var e=[],o=arguments.length-1;o-- >0;)e[o]=arguments[o+1];n("event name",t);var i=this._subscribers[t];if(i)for(var r=0;r<i.length;r++)"function"==typeof i[r]&&i[r].apply(null,e);return this},i.prototype.broadcast=function(t,e,o,i){return n("event name",t),"function"==typeof e?(i=e,e={}):"function"==typeof o&&(i=o,o=""),this.call("aladdin","broadcast",{eventName:t,event:e,url:o},i),this},i.prototype.use=function(t,e){n("Component",t,"function");var o=new t(this);return e=e||o.name||t.name.replace(/^([A-Z])/,function(t){return t.toLowerCase()}),n("Component's name",e),this[e]=o,this},i.prototype.support=function(t,e,o){return n("component name",t),"function"==typeof e&&(o=e,e=""),this.call("aladdin","support",{component:t,action:e},o),this},i.prototype._transformHandlers=function(t,e,n,i){var r=this;for(var a in n){var s=n[a];if(s){var c=Object.prototype.toString.call(s);if("[object Object]"!==c&&"[object Array]"!==c||r._transformHandlers(t,e,s,i,A),"[object Function]"===c){var u=i+"_function_"+ ++A+"_"+t+"_"+e+"_"+(isNaN(a)?a:"callback");n[a]=u,r._handlers[u]=o.call(r,s)}}}},i.prototype.call=function(){var e=arguments,n=this;t(function(){n.callSync.apply(n,e)})},i.prototype.callSync=function(t,e){for(var n=[],o=arguments.length-2;o-- >0;)n[o]=arguments[o+2];var i={component:t,action:e,args:n,callId:(this._ts+ ++this._callTimes).toString(16)};A=0,this._transformHandlers(i.component,i.action,i.args,i.callId),i.message=i.component+"."+i.action+"?"+encodeURIComponent(JSON.stringify(i.args)),this.emit("call",i);var r;if(C.isAndroid)r=prompt("aladdin://"+i.message);else if(C.isiOS){S[i.callId]=i.message,window.__ALADDIN__||(window.__ALADDIN__={});var a=document.createElement("IFRAME");a.setAttribute("src","aladdin://delay-fetch?callId="+i.callId),a.setAttribute("style","display: none;"),document.documentElement.appendChild(a),a.parentNode.removeChild(a),a=null,r=window.__ALADDIN__.retValue,window.__ALADDIN__.retValue=void 0}return r},i.prototype.callback=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(t){var o=this._handlers[t];this.emit("callback",{handlerKey:t,handler:o,args:e}),o&&"function"==typeof o&&(o.apply(null,e),o.keep||delete this._handlers[t])}},i.prototype.fetch=function(t){var e=S[t];return e&&delete S[t],e},e(s.prototype,"name","navigator"),s.prototype._to=function(t,e,n){return e=e||{},e.qs&&"object"==typeof e.qs&&(e.url=a(e.url,e.qs,e.traditional)),this._aladdin.call(this.name,t,e,n),this},s.prototype.forward=function(t,e){return this._to("forward",t,e)},s.prototype.replace=function(t,e){return this._to("replace",t,e)},s.prototype.back=function(t,e){return t=t||{},"function"==typeof t&&(e=t,t={}),this._aladdin.call(this.name,"back",t,e),this},s.prototype.backTop=function(t,e){return t=t||{},"function"==typeof t&&(e=t,t={}),this._aladdin.call(this.name,"backTop",t,e),this},c.prototype.json=function(){return this.body?JSON.parse(this.body):{}},c.prototype.text=function(){return this.body},c.prototype.header=function(t){var e=this;if(t=t.toLowerCase(),!this.headers)return"";for(var n in e.headers)if(n.toLowerCase()===t)return e.headers[n];return""},e(p.prototype,"name","http"),p.prototype.request=function(t,e){return t=l(t),e=u(e),this._aladdin.call(this.name,"request",t,e),this},p.prototype.setCookie=function(t,e){return this._aladdin.call(this.name,"setCookie",t,e),this},p.prototype.getCookie=function(t,e,n){return this._aladdin.call(this.name,"getCookie",t,e,n),this},p.prototype.removeCookie=function(t,e,n){return this._aladdin.call(this.name,"removeCookie",t,e,n),this},p.prototype.upload=function(t,e){return t=t||{},t.method=t.method||"post",t=l(t),this._aladdin.call(this.name,"upload",t,e),this},p.prototype.download=function(t,e){return t=l(t),this._aladdin.call(this.name,"download",t,e),this};var I=function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},k=function(t){return"string"!=typeof t&&("[object Null]"===toString.call(t)||void 0===t?t+="":t=t.toString()),t};d.prototype.getItem=function(t,e,n,o){"function"==typeof e?(o=e,e=!1,n="3DES"):"function"==typeof n?(e=!!e,o=n,n="3DES"):(e=!!e,n=n||"3DES"),t=k(t);var i={key:t,share:e,crypto:n};return this._aladdin.call(this.name,"getItem",i,function(t,e){try{e="undefined"!==e?JSON.parse(e):void 0}catch(t){e=null}o(t,e)}),this},d.prototype.setItem=function(t,e,n,o,i){t=k(t),e=void 0!==e?JSON.stringify(e):"undefined","function"==typeof n?(i=n,n=!1,o="3DES"):"function"==typeof o?(n=!!n,i=o,o="3DES"):(n=!!n,o=o||"3DES");var r={key:t,value:e,share:n,crypto:o};return this._aladdin.call(this.name,"setItem",r,i),this},d.prototype.removeItem=function(t,e,n){t=k(t),"function"==typeof e&&(n=e,e=!1);var o={key:t,share:e};return this._aladdin.call(this.name,"removeItem",o,n),this},d.prototype.clear=function(t){return this._aladdin.call(this.name,"clear",t),this},I(f,d),e(f.prototype,"name","localStorage"),I(h,d),e(h.prototype,"name","sessionStorage"),e(y.prototype,"name","header"),y.prototype.config=function(t,e){return this._aladdin.call(this.name,"config",t||{},e),this},e(m.prototype,"name","page"),m.prototype.bounce=function(t,e){return this.config({bounce:!!t},e),this},m.prototype.swipe=function(t,e){return this.config({swipe:!!t},e),this},m.prototype.config=function(t,e){return this._aladdin.call(this.name,"config",t||{},e),this};var D=new i;return D.env=C,D.use(s).use(p).use(y).use(f).use(h).use(m),function(e){window.__ALADDIN_CALLBACK__=function(){var n=arguments;t(function(){e.callback.apply(e,n)})},window.__ALADDIN_EVENT_EMIT__=function(){var n=arguments;t(function(){e.emit.apply(e,n)})},window.__ALADDIN_FETCH__=function(t){return e.fetch(t)}}(D),D});